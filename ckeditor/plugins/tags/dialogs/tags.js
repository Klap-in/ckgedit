CKEDITOR.dialog.add("tagsDialog",function(c){var b={};var g=c.lang.tags;var a="test";var e=function(){var k=c.document.$.children[0].children[1].innerHTML.replace(/<[^<>]*>/g,"").replace(/&gt;/g,">");var n=(/\{\{tag>.*?\}\}/g);var m=n.exec(k);var l=[];var j=function(p){if(m!=null){var r=new RegExp("( |>)"+p.toUpperCase()+"( |})","g");for(var q=0;q<m.length;q++){if(r.test(m[q].toUpperCase())){return true}}return false}else{return false}};jQuery.ajax(DOKU_BASE+"lib/exe/ajax.php",{data:{call:"tagapi_list"},type:"POST",async:false,dataType:"json",success:function(p,q,i){b=p.tags},error:function(i,q,p){alert(q);alert(p)}});var o={type:"hbox",children:[]};l[l.length]=o;for(var h=0;h<b.length;h++){o.children[o.children.length]={type:"checkbox",id:b[h].id,label:b[h].name,"default":b[h].name==""?"":(j(b[h].id)?"checked":""),userdef:false};if(((h%5)==4)&&((h+1)<b.length-1)){o={type:"hbox",children:[]};l[l.length]=o}}l[l.length]={type:"checkbox",id:"",label:"","default":"",userdef:false};var d=l[l.length-1];d.userdef=true;d.id="user_def_box";d.label=g.customTags;l[l.length-1]={type:"vbox",children:[d,{type:"text",id:"user_def_text"},{type:"html",html:"If <code>Cursor</code> is selected, the old tag syntax must be selected and it will be replaced. If there are no old tags, the the new tag(s) will  be inserted at the cursor"},{type:"radio",id:"which",label:"Place tags at: ",items:[["Bottom","bottom"],["Cursor ","cursor"]],style:"color: green","default":"bottom",onClick:function(){alert("Current value: "+this.getValue())}}]};return l};var f={title:g.dlgTitle,minWidth:500,minHeight:200,contents:[{id:"tab-basic",label:"Settings",elements:e()}],onOk:function(){var j=this;var l="{{tag>";var h="}}";var k="";var m="unset";var j=this;for(var d=0;d<b.length;d++){k+=j.getValueOf("tab-basic",b[d].id)?b[d].id+" ":""}k+=j.getValueOf("tab-basic","user_def_box")?j.getValueOf("tab-basic","user_def_text")+" ":"";m=j.getValueOf("tab-basic","which");k=k.replace(/\s+$/,"");data=c.getData();k="{{tag&gt;"+k+"}}";if(m=="cursor"){c.insertHtml(k)}else{c.setData(data.replace(/\{\{tag&gt;.*?\}\}/g,"")+k)}},onLoad:function(){}};return f});